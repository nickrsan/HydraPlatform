{% extends "page_layout.html" %}
{% block title %}Network {{network.network_name}}{% endblock %}
{% block content %}
    <div class="main_content">
    <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename='css/network.css') }}"/>
  <script>


  // set up initial nodes and links
  //  - nodes are known by 'id', not by index in array.
  //  - reflexive edges are indicated on the node (as a bold black circle).
  //  - links are always source < target; edge directions are set by 'left' and 'right'.
    var scenario_id={{scenario_id}};
    var data_={{node_name_map|tojson}};
    function get_name(id)
    {
    value='None'
    for (i in data_)
    {
        if(data_[i].id==id)
        {
            value=data_[i].name;
            break;
        }
    }
     return value;
     }

     var nodes_=[]
     nodes_={{nodes_|tojson}};
     attr_id_name={{attr_id_name|tojson}};


   var links_=[];
   var links_={{links_|tojson}};


    var min_x = {{extents['min_x']}};
    var max_x = {{extents['max_x']}};
    var min_y = {{extents['min_y']}};
    var max_y = {{extents['max_y']}};

    var nodes = [];
    var node_coords = {};
    var lastNodeId = null;
    {% for id, coord in node_coords.items()%}
      nodes.push(
        {
          'id': {{id}},
          'reflexive':false,
          'x':{{coord[0]}},
          'y':{{coord[1]}},
        }
      )
      lastNodeId={{id}};
      node_coords[{{id}}] = [{{coord[0]}}, {{coord[1]}}];
    {% endfor %}

    var links = [];
    {% for id, connected_nodes in links.items()%}
        links.push(
          {
            'source': {{connected_nodes[0]}},
            'target': {{connected_nodes[1]}},
            'left'  : 'true',
            'right' : 'false',
          }
        )
    {% endfor %}
    var node_img="{{ url_for('static', filename='img/black_dot.png')}}";
      </script>
              {% include 'network_details.html' %}

        <ul id="network-tabs" class="nav nav-tabs" role="tablist">
            <li role="presentation" id="statictab">
                <a data-toggle="tab">Graph View</a>
            </li>
            <li role="presentation" id="listtab">
                <a data-toggle="tab">List View</a>
            </li>
        </ul>

      <div id="tab-contents"> <!--This is just to provide some styling rules to the tab contents overall -->

      <div id="graph_container" class="network_container">
            <div id="graph" class="left">
                <div class="checkbox">
             <label >
                 <input id="label" type='checkbox' onclick='changeNodesLableVisibility(this);'>
                 Display labels</label>
                                 <label><input type='checkbox' onclick='changeLinkDirectionVisibility(this);'>Link direction</label>

             <input id="search">
             <button type="button" onclick="findResource()">Select</button>
                      <button type="button" onclick="runModel()" style=" float: right;">Run model ></button>
                                      </div>
        </div> <!-- graph_container -->
            <div id="data" class="data_container">
             </div>
       {% include 'nodesandlinks.html' %}

        </div> <!-- tab-contents -->

      </div> <!-- main_content -->

<div class="modal fade" tabindex="-1" role="dialog" id="ts_modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Timeseries Graph</h4>
      </div>
      <div class="modal-body">
        <div id="timeseries_g" class="timeseries_gr">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <!-- <button type="button" class="btn btn-primary">Save changes</button>-->
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

        <!-- this needs to be updated and turned into a tooltip that can be hidden -->

        <!--Include css & javascript-->
        <script type='text/javascript' src="{{url_for('static', filename='js/d3.v3.min.js')}}"></script>
        <script src="http://d3js.org/topojson.v0.min.js"></script>
        <script type='text/javascript' src="{{url_for('static', filename='js/d3_tip.js')}}"></script>
        <script src="{{url_for('static', filename='js/createResourceAttributesTable.js')}}"></script>
        <script src="{{url_for('static', filename='js/network_displayer.js')}}"></script>
        <script src="{{url_for('static', filename='js/network.js')}}"></script>


<script>
         $(function() {
            var res_names = [];
            for ( i in nodes_)
            {
            res_names.push(nodes_[i].name);
            }
            for(i in links_)
            {
             res_names.push(links_[i].name);
            }
            $( "#search" ).autocomplete({
               source: res_names
            });
         });


    </script>
  <script>

  </script>
    {% endblock %}
